{% extends "page.html" %}
{% set active_page = "collections" %}
{% block content %}
<div id="maincontent">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
  <h1>{{ feature.title }}</h1>
  {% if feature.description is not none %}
    <div>{{ feature.description|safe }}</div>
  {% endif %}
  {% if feature.geometries is not none %}
    <div id="map"></div>
    <table class="lined">
    {% for k,v in feature.properties.items() %}
      <tr>
        <td>{% if "name" in v.keys() %}
          <span class="tooltip">{{ v.name }}<span class="tooltiptext"><a href="{{ k }}">{{ v.prefixedURI }}</a></span></span>
            {% else %} {{ k }}
            {% endif %}
        </td>
        <td><code>{{ v.val }}</code></td>
      </tr>
    {% endfor %}
    {% for geometry in feature.geometries %}
      <tr>
        <td>{{ geometry.label }}</td><td><code>
        {% if geometry.coordinates.split()|length > 6 %}
          {{ ' '.join(geometry.coordinates.split()[:6]+[' ... ']+geometry.coordinates.split()[-6:]) }}
        {% else %}{{ geometry.coordinates }}
        {% endif %}</code></td>
      </tr>
    {% endfor %}
    </table>
  {% endif %}
  <script>
    const data = '{{ map_polygon | tojson }}';
    const map = L.map('map');

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
      accessToken: 'pk.eyJ1IjoiamFtaWVmZWlzcyIsImEiOiJja3Exb3U5anAwZ3lrMnBrMXFlMXUxazZ2In0.2rBPhgnwrWJKNl2GsXV5HQ',
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1
    }).addTo(map);
    
    const geojsonLayer = L.geoJson(JSON.parse(data.slice(1, data.length - 1))).addTo(map);
    map.fitBounds(geojsonLayer.getBounds());  
  </script>
</div>
{% include 'page_altprofiles.html' %}
{% endblock %}